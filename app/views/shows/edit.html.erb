<script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/rgbcolor.js"></script> 
<script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/StackBlur.js"></script>
<script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/canvg.js"></script>
<div class="container">
	<div class="editor-wrapper">
		<div class="canvas-container"><svg id="canvas" class="canvas" width="400" height="400"></svg></div>
		<div class="info-field">
			<%= form_for @show do |f|%>
				<%= f.hidden_field :id %>
				<%= f.text_field :name, autocomplete:"off",placeholder:"type name..." %>
				<%= f.hidden_field :data %>
				<%= f.hidden_field :behavior,{value:"finish_edit"}%>
			<% end %>
			<a href="#" id="download-png" download='<%= @show.name %>.png' style="font-size: 16px;">Download</a>
			<div id="save-btn" class="lsf-icon finished-btn" title="ok">完成</div>
		</div>
		
	</div>
	<div class="edit-tool">
		<div type="color" class="color-picker" id="color-picker"></div>
		<div class="paint-mode-group">
			<div class="mode-btn lsf-icon active" title="brush" data-mode=1></div>
			<div class="mode-btn lsf-icon" title="paint" data-mode=3></div>
		</div>
		
	</div>
</div>
<canvas id="temp-canvas" style="display:none"></canvas>
<script type="text/javascript">
var length=400;
var length = $("svg.canvas").attr("width");
var size = 10;
var dataset;
var dataArr;
$(document).on('page:change',function(){

	dataset = ShowWidget.convertStrToCodeArr("<%= @show.data %>");
	ShowWidget.generateShow('svg.canvas', 10, dataset);
	ShowWidget.generateAxis('svg.canvas');

	EditorWidget.init();
	ColorPickerWidget.init();
});



</script>

<script>

	var cs;
	var ColorPickerWidget;

	ColorPickerWidget = {
		settings:{
			
			initialColor:'#02508d',
		},
		init: function(){
			cs = ColorPickerWidget.settings;
			es.currentColor = cs.initialColor;
			ColorPickerWidget.bindUIActions();
			ColorPickerWidget.initColorPicker();
		},
		bindUIActions: function(){
			
		},
		initColorPicker: function(){
			$('#color-picker').css('background-color',cs.initialColor);
			$("#color-picker").spectrum({
				className: 'color-picker',
			    color: cs.initialColor,
			    preferredFormat: "hex",
			    showInput: true,
			    showPalette: true,
			    clickoutFiresChange: true,
			    showInitial: true,
			    showButtons: false,
			    beforeShow: function(color) {
			    	
				},
			    change: function(color) {
			    	// console.log("change!!");
			    	es.currentColor = color;
			    	$('#color-picker').css('background-color',color);
				},
				move: function(color) {
						es.currentColor = color;
			    	$('#color-picker').css('background-color',color);
				}
			});
		}
	}

</script>